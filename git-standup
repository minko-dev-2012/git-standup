#!/bin/sh

if [ $# -gt 2 ] ; then
  >&2 echo "Usage: $0 [weekstart-weekend] [fullname]\nExample: $0 MON-FRI \"John Doe\""
  exit 1
fi


AUTHOR=${2:-"`git config user.name`"}

WEEKSTART="$( cut -d '-' -f 1 <<< "$1" )";
WEEKEND="$( cut -d '-' -f 2 <<< "$1" )";


WEEKSTART=${WEEKSTART:="Mon"}
WEEKEND=${WEEKEND:="Fri"}


since=yesterday

# Case in-sensitive comparison
shopt -s nocasematch

# If start of the week
if [[ $WEEKSTART == "$(date +%a)" ]] ; then 
  since="last $WEEKEND";
fi

# If not in a repo, iterate through first level of folders
if [ ! -d ".git" ]; then
	for d in */ ; do
		cd $d
		if [ -d ".git" ]; then
			GITOUT=`git log --since "$since" --all --abbrev-commit --no-merges --oneline --committer="$AUTHOR" --pretty=format:' %Cred%h%Creset - %s %Cgreen(%cr) %C(bold blue)<%an>%Creset'`
			# Only output if there is some activity
			if [ ! -z "$GITOUT" ];  then
				echo "$d\n$GITOUT"
			fi
		fi
		cd ..
	done
else
	git log --since "$since" --all --abbrev-commit --no-merges --oneline --committer="$AUTHOR" --pretty=format:'%Cred%h%Creset - %s %Cgreen(%cr) %C(bold blue)<%an>%Creset'
fi
